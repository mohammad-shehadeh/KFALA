<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>معرض الصور من الجذر</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .info-box {
            background: #e8f4fc;
            border-right: 5px solid #3498db;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats {
            text-align: center;
            padding: 12px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #2c3e50;
            border: 2px dashed #3498db;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 10px 20px;
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn.secondary {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid #eee;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            border-bottom: 1px solid #eee;
        }
        
        .card-content {
            padding: 15px;
        }
        
        .card-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #2c3e50;
            word-break: break-word;
        }
        
        .file-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .download-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .download-btn:hover {
            background: linear-gradient(to right, #2980b9, #1f639e);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.85rem;
            border-top: 1px solid #e0e0e0;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            font-size: 1.1rem;
            color: #3498db;
            grid-column: 1 / -1;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            background: #ffebee;
            color: #c62828;
            border-radius: 10px;
            margin: 20px 0;
            grid-column: 1 / -1;
        }
        
        .image-counter {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .image-container {
            position: relative;
        }
        
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .gallery {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-camera"></i> معرض الصور من الجذر</h1>
            <p class="subtitle">جميع الصور مأخوذة تلقائيًا من نفس مستوى ملف index.html</p>
            <div class="info-box">
                <i class="fas fa-folder-open"></i>
                <span>المجلد الحالي: الجذر (نفس مكان index.html)</span>
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="scanForImages()">
                    <i class="fas fa-search"></i> مسح المجلد للصور
                </button>
                <button class="control-btn secondary" onclick="showHowToAddImages()">
                    <i class="fas fa-question-circle"></i> كيفية إضافة صور
                </button>
            </div>
        </header>
        
        <div class="stats" id="statsContainer">
            <i class="fas fa-sync-alt fa-spin"></i> جاري البحث عن الصور...
        </div>
        
        <div id="imageGallery" class="gallery">
            <!-- سيتم إضافة الصور هنا ديناميكيًا -->
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> جاري فحص الملفات في الجذر...
            </div>
        </div>
        
        <div class="footer">
            <p>معرض الصور التلقائي &copy; <span id="currentYear"></span> | جميع الصور موجودة في نفس مستوى الملف</p>
        </div>
    </div>

    <script>
        // سنة حقوق النشر
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // العناصر الرئيسية
        const galleryElement = document.getElementById('imageGallery');
        const statsContainer = document.getElementById('statsContainer');
        
        // امتدادات الصور المدعومة
        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg'];
        
        // قائمة بأسماء الصور المحتملة (يمكن تعديلها حسب احتياجاتك)
        const commonImageNames = [
            'IMG_4419.jpeg', 'IMG_4420.jpg', 'IMG_4421.png',
            'photo1.jpg', 'photo2.jpg', 'image1.png', 'image2.jpeg',
            'nature.jpg', 'sunset.png', 'mountain.jpeg', 'beach.jpg',
            'profile.png', 'logo.png', 'background.jpg'
        ];
        
        // دالة للمسح التلقائي للصور
        async function scanForImages() {
            galleryElement.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> جاري فحص جميع الملفات في الجذر...
                </div>
            `;
            
            statsContainer.innerHTML = `<i class="fas fa-search"></i> جاري البحث عن الصور في الجذر...`;
            
            try {
                // محاولة الحصول على قائمة الملفات من الخادم
                let imageFiles = [];
                
                try {
                    // طريقة 1: محاولة جلب الفهرس من الخادم
                    const response = await fetch('./');
                    if (response.ok) {
                        const html = await response.text();
                        imageFiles = extractImageFilesFromHTML(html);
                    }
                } catch (e) {
                    console.log("لا يمكن جلب الفهرس تلقائيًا، استخدام المسح المباشر");
                }
                
                // إذا لم نحصل على نتائج، نستخدم المسح المباشر
                if (imageFiles.length === 0) {
                    imageFiles = await scanImagesDirectly();
                }
                
                // عرض النتائج
                displayImages(imageFiles);
                
            } catch (error) {
                console.error('خطأ في المسح:', error);
                showError('حدث خطأ أثناء البحث عن الصور: ' + error.message);
            }
        }
        
        // دالة لاستخراج أسماء الصور من HTML الفهرس
        function extractImageFilesFromHTML(html) {
            const imageFiles = [];
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // البحث عن جميع الروابط في الصفحة
            const links = doc.querySelectorAll('a');
            
            links.forEach(link => {
                const href = link.getAttribute('href');
                if (!href) return;
                
                // استبعاد الروابط الخاصة (مثل المجلدات والروابط الأخرى)
                if (href === '../' || href === './' || href.includes('?')) return;
                if (href.endsWith('/')) return; // استبعاد المجلدات
                
                // التحقق مما إذا كان الملف صورة
                const lowerHref = href.toLowerCase();
                const isImage = imageExtensions.some(ext => lowerHref.endsWith(ext));
                
                if (isImage) {
                    imageFiles.push({
                        name: href,
                        title: getImageTitle(href)
                    });
                }
            });
            
            return imageFiles;
        }
        
        // دلة للمسح المباشر للصور (محاولة تحميل كل صورة محتملة)
        async function scanImagesDirectly() {
            const foundImages = [];
            
            // أولاً: فحص الأسماء الشائعة
            for (const imgName of commonImageNames) {
                if (await checkImageExists(imgName)) {
                    foundImages.push({
                        name: imgName,
                        title: getImageTitle(imgName)
                    });
                }
            }
            
            // ثانياً: محاولة فحص نطاق من الأسماء
            // هذا مفيد إذا كانت صورك بأسماء مثل IMG_4419.jpeg, IMG_4420.jpeg, etc.
            for (let i = 1; i <= 50; i++) {
                const possibleNames = [
                    `IMG_${4400 + i}.jpeg`,
                    `IMG_${4400 + i}.jpg`,
                    `IMG_${4400 + i}.png`,
                    `image${i}.jpg`,
                    `photo${i}.jpeg`,
                    `pic${i}.png`
                ];
                
                for (const name of possibleNames) {
                    if (await checkImageExists(name)) {
                        // تجنب التكرار
                        if (!foundImages.some(img => img.name === name)) {
                            foundImages.push({
                                name: name,
                                title: getImageTitle(name)
                            });
                        }
                    }
                }
            }
            
            return foundImages;
        }
        
        // دالة للتحقق من وجود صورة
        function checkImageExists(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url + '?t=' + new Date().getTime(); // إضافة طابع زمني لتجنب الكاش
            });
        }
        
        // دالة لإنشاء عنوان للصورة من اسمها
        function getImageTitle(filename) {
            // إزالة الامتداد
            let title = filename.replace(/\.[^/.]+$/, "");
            
            // استبدال الشرطات والخطوط السفلية بمسافات
            title = title.replace(/[_-]/g, " ");
            
            // تحويل أول حرف إلى كبير
            title = title.charAt(0).toUpperCase() + title.slice(1);
            
            return title;
        }
        
        // دالة لعرض الصور
        function displayImages(imageFiles) {
            // تحديث الإحصائيات
            if (imageFiles.length === 0) {
                statsContainer.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i> لم يتم العثور على أي صور في الجذر
                `;
                
                galleryElement.innerHTML = `
                    <div class="error">
                        <i class="fas fa-images"></i>
                        <h3>لم يتم العثور على صور</h3>
                        <p>لا توجد صور في نفس مستوى ملف index.html</p>
                        <p>لإضافة صور:</p>
                        <ol style="text-align: right; margin: 15px 0; padding-right: 20px;">
                            <li>انقل صورك إلى نفس المجلد الذي يحتوي على index.html</li>
                            <li>تأكد من أن أسماء الصور تحتوي على امتدادات مثل .jpg أو .png</li>
                            <li>اضغط على زر "مسح المجلد للصور"</li>
                        </ol>
                        <button class="control-btn" onclick="scanForImages()" style="margin-top: 10px;">
                            <i class="fas fa-redo"></i> حاول مرة أخرى
                        </button>
                    </div>
                `;
                return;
            }
            
            statsContainer.innerHTML = `
                <i class="fas fa-check-circle"></i> تم العثور على ${imageFiles.length} صورة في الجذر
            `;
            
            // إنشاء معرض الصور
            let galleryHTML = '';
            
            imageFiles.forEach((image, index) => {
                galleryHTML += `
                    <div class="card">
                        <div class="image-container">
                            <div class="image-counter">${index + 1}</div>
                            <img src="${image.name}" alt="${image.title}" 
                                 onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/e0e0e0/757575?text=خطأ+في+الصورة'">
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${image.title}</h3>
                            <div class="file-info">
                                <span><i class="far fa-file"></i> ${image.name}</span>
                                <span><i class="fas fa-expand-arrows-alt"></i> أصلي</span>
                            </div>
                            <button class="download-btn" onclick="downloadImage('${image.name}', '${image.title}')">
                                <i class="fas fa-download"></i> تحميل إلى الهاتف
                            </button>
                        </div>
                    </div>
                `;
            });
            
            galleryElement.innerHTML = galleryHTML;
        }
        
        // دالة لتحميل الصور
        function downloadImage(imageUrl, imageTitle) {
            // إنشاء رابط تحميل
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = imageTitle.replace(/\s+/g, '_') + '.' + imageUrl.split('.').pop();
            
            // إضافة الرابط إلى الصفحة والنقر عليه
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // إظهار رسالة تأكيد
            showMessage(`جاري تحميل "${imageTitle}" إلى معرض الصور في هاتفك`);
        }
        
        // دالة لعرض رسالة للمستخدم
        function showMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            messageDiv.innerHTML = `
                <i class="fas fa-check-circle"></i> ${message}
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => document.body.removeChild(messageDiv), 300);
            }, 3000);
            
            // إضافة أنيميشن
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
        
        // دالة لعرض رسالة خطأ
        function showError(message) {
            galleryElement.innerHTML = `
                <div class="error">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>حدث خطأ</h3>
                    <p>${message}</p>
                    <button class="control-btn" onclick="scanForImages()" style="margin-top: 10px;">
                        <i class="fas fa-redo"></i> حاول مرة أخرى
                    </button>
                </div>
            `;
            
            statsContainer.innerHTML = `<i class="fas fa-times-circle"></i> خطأ في البحث`;
        }
        
        // دالة لعرض كيفية إضافة الصور
        function showHowToAddImages() {
            const instructions = `
                <div style="text-align: right; background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3><i class="fas fa-info-circle"></i> كيفية إضافة صور إلى المعرض:</h3>
                    <ol style="margin: 15px 0; padding-right: 20px;">
                        <li>تأكد من أن صورك موجودة في <strong>نفس المجلد</strong> الذي يحتوي على index.html</li>
                        <li>يمكن أن تكون أسماء الصور مثل:
                            <ul style="margin: 10px 0; padding-right: 20px;">
                                <li>IMG_4419.jpeg</li>
                                <li>صورة.jpg</li>
                                <li>photo.png</li>
                            </ul>
                        </li>
                        <li>الامتدادات المدعومة: .jpg, .jpeg, .png, .gif, .bmp, .webp, .svg</li>
                        <li>بعد إضافة الصور، اضغط على زر "مسح المجلد للصور"</li>
                    </ol>
                    <p style="background: #f8f9fa; padding: 10px; border-radius: 5px; border-right: 4px solid #3498db;">
                        <i class="fas fa-lightbulb"></i> <strong>ملاحظة:</strong> إذا لم تظهر الصور تلقائيًا، 
                        تأكد من أن الخادم يسمح بسرد الملفات (directory listing).
                    </p>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; max-width: 500px; width: 90%; position: relative;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: 10px; left: 10px; background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                    ${instructions}
                    <button class="control-btn" onclick="this.parentElement.parentElement.remove(); scanForImages()" 
                            style="width: 100%; margin-top: 15px;">
                        <i class="fas fa-search"></i> ابدأ المسح الآن
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // بدء المسح تلقائيًا عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', scanForImages);
    </script>
</body>
</html>